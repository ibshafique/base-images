# Security Policy

## Reporting Vulnerabilities

If you discover a security vulnerability, please report it responsibly by opening a GitHub issue (for this educational project) or contacting the maintainers directly.

## SLSA Build Level

**Level 2** (Build L2)

Requirements met:
- Provenance generated by build service (GitHub Actions + BuildKit)
- Build process scripted/defined
- Provenance authenticated (signed with Cosign keyless)
- Service-generated provenance

Not met (would be L3):
- Hermetic builds (network access during build)
- Fully isolated build environment

### Why Not L3?

Achieving true SLSA Build L3 requires:
- Using `slsa-github-generator` instead of direct docker/build-push-action
- Hermetic builds (no network access, all dependencies pre-fetched)
- Isolated build environment
- Significantly more complex workflow

For an educational project, L2 provides sufficient supply-chain transparency while remaining understandable and maintainable.

### Provenance Format

SLSA v1.0 in-toto format:

```json
{
  "buildType": "https://mobyproject.org/buildkit@v1",
  "builder": {
    "id": "https://github.com/docker/build-push-action"
  },
  "invocation": {
    "configSource": {
      "uri": "git+https://github.com/ibshafique/base-images@refs/heads/main",
      "digest": {"sha1": "abc123..."}
    },
    "parameters": {}
  },
  "materials": []
}
```

### Verification

```bash
# View provenance attestation
cosign verify-attestation \
  --type slsaprovenance \
  --certificate-identity-regexp="https://github.com/ibshafique/base-images" \
  --certificate-oidc-issuer=https://token.actions.githubusercontent.com \
  ghcr.io/ibshafique/base-images/scratch-plus:latest \
  | jq -r '.payload' | base64 -d | jq
```

**Future Work**: Upgrade to L3 by adopting slsa-github-generator (see roadmap).

## SBOM Generation

**Format**: SPDX 2.3 (JSON)
**Tool**: BuildKit (Docker Buildx)

### Generation

Automatically generated during `docker buildx build` when `sbom: true` is set.

### Contents

- Package inventory (name, version, license)
- File hashes (SHA256)
- Layer provenance
- Build timestamp

### Attachment

- Attached to image as OCI artifact (via BuildKit)
- In-toto attestation format
- Discoverable via cosign tree / docker scout

### Viewing

```bash
# Via cosign
cosign verify-attestation --type spdx \
  --certificate-identity-regexp="https://github.com/ibshafique/base-images" \
  --certificate-oidc-issuer=https://token.actions.githubusercontent.com \
  IMAGE

# Via syft (reads attached SBOM)
syft packages IMAGE

# Via docker scout
docker scout sbom IMAGE
```

Note: We use BuildKit's built-in SBOM generation (not Syft/Trivy) for simplicity and integration. All methods produce SPDX format.

## Image Signing

All images are signed using Cosign keyless signing (Sigstore) in the CI/CD pipeline.

### Verification

```bash
cosign verify \
  --certificate-identity-regexp="https://github.com/ibshafique/base-images" \
  --certificate-oidc-issuer=https://token.actions.githubusercontent.com \
  ghcr.io/ibshafique/base-images/scratch-plus:latest
```

Both per-architecture images and multi-arch manifests are signed.

## Vulnerability Scanning

Images are scanned in CI/CD using:
- **Trivy**: SARIF reports uploaded to GitHub Security tab
- **Grype**: Fails build on CRITICAL vulnerabilities

## Security Controls

| Control | Implementation | Tool |
|---------|---------------|------|
| **Non-root user** | UID 65532 in all images | Dockerfile USER directive |
| **No shell** | scratch/distroless base | Base image selection |
| **No package manager** | Minimal base images | Base image selection |
| **Image signing** | Cosign keyless (Sigstore) | sigstore/cosign |
| **Provenance** | SLSA Build L2 attestation | BuildKit (docker/build-push-action) |
| **SBOM Generation** | Per-image SPDX | BuildKit (docker/build-push-action) |
| **Vulnerability scanning** | Trivy + Grype | CI/CD pipeline |
| **Pinned dependencies** | Digest-pinned base images | Dockerfile FROM directives |
